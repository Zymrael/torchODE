#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Mon May 13 08:46:52 2019

@author: zymrael
"""


import re

a = ['Stall:10985	W0_Idle:16835	W0_Scoreboard:13260	W1:206	W2:0	W3:0	W4:0	W5:0	W6:0	W7:0	W8:0	W9:0	W10:0	W11:0	W12:0	W13:0	W14:0	W15:0	W16:0	W17:0	W18:0	W19:0	W20:0	W21:0	W22:0	W23:0	W24:0	W25:0	W26:0	W27:0	W28:0	W29:0	W30:0	W31:0	W32:57344',
     'Stall:13998	W0_Idle:44157	W0_Scoreboard:36701	W1:1598	W2:0	W3:0	W4:0	W5:0	W6:0	W7:0	W8:0	W9:0	W10:0	W11:0	W12:0	W13:0	W14:0	W15:0	W16:0	W17:0	W18:0	W19:0	W20:0	W21:0	W22:0	W23:0	W24:0	W25:0	W26:0	W27:0	W28:0	W29:0	W30:0	W31:0	W32:114688',
     'Stall:17133	W0_Idle:78283	W0_Scoreboard:113632	W1:10290	W2:196	W3:0	W4:0	W5:0	W6:0	W7:0	W8:0	W9:0	W10:0	W11:0	W12:0	W13:0	W14:0	W15:0	W16:0	W17:0	W18:0	W19:0	W20:0	W21:0	W22:0	W23:0	W24:0	W25:0	W26:0	W27:0	W28:0	W29:0	W30:0	W31:0	W32:172032',
     'Stall:308885	W0_Idle:101656	W0_Scoreboard:375603	W1:103334	W2:22888	W3:5880	W4:1236	W5:86	W6:0	W7:0	W8:0	W9:0	W10:0	W11:0	W12:0	W13:0	W14:0	W15:0	W16:0	W17:0	W18:0	W19:0	W20:0	W21:0	W22:0	W23:0	W24:0	W25:0	W26:0	W27:0	W28:0	W29:0	W30:0	W31:0	W32:229376',
     'Stall:7621161	W0_Idle:873036	W0_Scoreboard:1625495	W1:210570	W2:89732	W3:58570	W4:40412	W5:28678	W6:24862	W7:21100	W8:19068	W9:18518	W10:16244	W11:14328	W12:13684	W13:12110	W14:11318	W15:10174	W16:9702	W17:8394	W18:7138	W19:7906	W20:5642	W21:5598	W22:6632	W23:5188	W24:4842	W25:4564	W26:3892	W27:2282	W28:1656	W29:822	W30:506	W31:62	W32:286720',
     'Stall:15777640	W0_Idle:995155	W0_Scoreboard:3012413	W1:289936	W2:135262	W3:90650	W4:66652	W5:51730	W6:45374	W7:40170	W8:36300	W9:34544	W10:31540	W11:27390	W12:26598	W13:22896	W14:21638	W15:19340	W16:17850	W17:15536	W18:14398	W19:16264	W20:14090	W21:13742	W22:15448	W23:15932	W24:14270	W25:14878	W26:13664	W27:11450	W28:8618	W29:4896	W30:3356	W31:956	W32:344218',
     'Stall:16063072	W0_Idle:1004742	W0_Scoreboard:3249668	W1:359726	W2:163376	W3:105834	W4:74358	W5:55456	W6:47260	W7:41038	W8:36750	W9:34702	W10:31728	W11:27626	W12:26662	W13:23068	W14:21748	W15:19436	W16:17930	W17:15664	W18:14524	W19:16466	W20:14230	W21:13928	W22:15496	W23:16008	W24:14286	W25:15002	W26:13664	W27:11450	W28:8618	W29:4896	W30:3356	W31:956	W32:401562',
     'Stall:16066227	W0_Idle:1007998	W0_Scoreboard:3256525	W1:360688	W2:163376	W3:105834	W4:74358	W5:55456	W6:47260	W7:41038	W8:36750	W9:34702	W10:31728	W11:27626	W12:26662	W13:23068	W14:21748	W15:19436	W16:17930	W17:15664	W18:14524	W19:16466	W20:14230	W21:13928	W22:15496	W23:16008	W24:14286	W25:15002	W26:13664	W27:11450	W28:8618	W29:4896	W30:3356	W31:956	W32:458906']
name = 'BFS'
n_kernels = 8

#a = ['Stall:429171	W0_Idle:4543485	W0_Scoreboard:1347322	W1:0	W2:0	W3:0	W4:0	W5:0	W6:0	W7:0	W8:0	W9:0	W10:0	W11:0	W12:0	W13:0	W14:0	W15:0	W16:0	W17:0	W18:0	W19:0	W20:0	W21:0	W22:0	W23:0	W24:0	W25:0	W26:0	W27:0	W28:0	W29:0	W30:0	W31:0	W32:4027392']
#name = 'STO'
#n_kernels = 1

def avg_SIMD(string , name, n_kernels):
    res = []
    for i in range(n_kernels):
        lanes = 0
        count = 0
        for seg in re.split(r"\s+", string[i]):
            o = re.search(r"(\d+)?\:(\d+)", seg)
            if o.group(1): lanes += int(o.group(1)) * int(o.group(2))
            count += int(32 * o.group(2))
        res.append(round((lanes/count)/100, 4))
    return res, name

print(avg_SIMD(a, name, n_kernels))